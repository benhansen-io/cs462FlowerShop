OAuth = require("oauth")

module.exports = (app) ->

  # Request an OAuth Request Token, and redirects the user to authorize it
  app.get "/foursquare_authorize", (req, res) ->
    getRequestTokenUrl = "https://www.google.com/accounts/OAuthGetRequestToken"

    # GData specifid: scopes that wa want access to
    gdataScopes = [querystring.escape("https://www.google.com/m8/feeds/"), querystring.escape("https://www.google.com/calendar/feeds/")]

    oa = new OAuth2(
      "YUQA4UNMFVOUJ4CLPQ3BYRZMYUI5IUDYDUZG3EMWOZT1NLGG",
      "YBCYO5LXII2UWWX0JQ35A1DJCAWG4V30UMWXNF2YIWWHU4UZ",
      "https://foursquare.com/",
      "/oauth2/authenticate"
      "/oauth2/access_token")


    oa.getOAuthAccessToken (error, oauth_token, oauth_token_secret, results) ->
      if error
        console.log "error"
        console.log error
        console.log "error: " + error
      else
        # store the tokens in the session
        console.log "oauth_token: " + oauth_token + "; oauth_token_secret: " + oauth_token_secret + "; results: " + results
        req.session.oa = oa
        req.session.oauth_token = oauth_token
        req.session.oauth_token_secret = oauth_token_secret

        # redirect the user to authorize the token
        res.redirect "https://www.google.com/accounts/OAuthAuthorizeToken?oauth_token=" + oauth_token

